1. Launch three new virtual machine instances. All should run an operating system from the Debian family. Dept. of Comp. Sci., S. P. College, Pune 76
2. Create a project folder containing an ansible.cfg file and an inventory file. The inventory file should contain the details for two managed nodes. Then, establish and test the connection between the Ansible control node and the two managed nodes.
3. Utilize variables to demonstrate user creation and add comments. Additionally, use the debug module to output the name of the created user and their associated comment.
4. Generate host_vars and define the variables username and comment for a selected host.
5. Create group_vars and define the variables username and comment for the 'all' group and at least one other group specified in the inventory.

Set AğŸŒ Step 1 â€“ Create AWS EC2 Instances

Log in to the AWS Management Console.

Go to â¡ï¸ EC2 â†’ Instances â†’ Launch Instance

Launch 3 Ubuntu 22.04 LTS instances (t2.micro, Free Tier OK).

Name them:

controller (Ansible Control Node)

web1 (Managed Node 1)

web2 (Managed Node 2)

Key pair: Create one (e.g., ansible-key.pem) â†’ download it.

Security Group:

Inbound rules â†’ allow ports 22 (SSH) and 80 (HTTP)

Outbound â†’ allow all.

Launch the instances âœ…

cd Downloads
scp -i "C:\Users\prach\Downloads\mykey.pem" "C:\Users\prach\Downloads\mykey.pem" ubuntu@3.108.236.202:/home/ubuntu/
ssh -i "mykey.pem" ubuntu@ec2-3-108-236-202.ap-south-1.compute.amazonaws.com    ---> of control node instance

sudo apt update -y
sudo apt install -y python3-pip
sudo apt install ansible -y
ansible --version

ssh-keygen -y -f ~/mykey.pem > ~/mykey.pub
chmod 400 ~/mykey.pem
ssh-keygen -y -f ~/mykey.pem > ~/mykey.pub
ssh -i ~/mykey.pem ubuntu@13.233.159.98 "mkdir -p ~/.ssh && cat >> ~/.ssh/authorized_keys" < ~/mykey.pub    
ssh -i ~/mykey.pem ec2-user@3.108.220.237 "mkdir -p ~/.ssh && cat >> ~/.ssh/authorized_keys" < ~/mykey.pub

mkdir ~/assignment4 && cd ~/assignment4
mkdir group_vars host_vars
nano ansible.cfg
[defaults]
inventory = ./inventory
private_key_file = ~/.ssh/ansible-key.pem
host_key_checking = False
nano inventory
[webservers]
web1 ansible_host=<web1-public-ip> ansible_user=ubuntu
web2 ansible_host=<web2-public-ip> ansible_user=ubuntu
ansible all -m ping
nano group_vars/all.yml
username: devuser
comment: "Default user for all web servers"
nano host_vars/web1.yml
username: adminuser
comment: "Admin user for web1 only"

nano create-user.yml
---
- hosts: all
  become: yes
  tasks:
    - name: Create user with host/group variables
      ansible.builtin.user:
        name: "{{ username }}"
        comment: "{{ comment }}"

    - name: Display confirmation message
      debug:
        msg: "User {{ username }} created on {{ inventory_hostname }}"
Run it:
ansible-playbook create-user.yml

Set B:
1. Launch two new virtual machine instances. All should run an operating system from the Debian family.
2. Create a project folder containing an ansible.cfg file and an inventory file. The inventory file should contain the details for two managed nodes. Then, establish and test the connection between the Ansible control node and the two managed nodes.
3. Generate a templates directory containing the necessary files:
â— Create index.html.j2 file and dipay ansible_hostname and ansible_default_ipv4.address use jinja2 formatting to accomplish the task.
â— Create and edit the nginx.conf.j2 file using Jinja2 templating to define the necessary NGINX configuration.
4. Write playbook to install Nginx server on all hosts present in inventory file.
5. Create a separate Ansible playbook. This playbook should copy the nginx.conf.j2 file to /etc/nginx/sites-available/[example.com].conf on all target servers.
6. Develop an independent Ansible playbook. This playbook's purpose is to replace the content within index.nginx-debian.html with the index.html.j2 file, and this change should be applied to all designated target servers.

mkdir templates
cd templates
nano index.html.j2
<html>
  <body>
    <h1>Welcome to {{ ansible_hostname }}</h1>
    <p>IP Address: {{ ansible_default_ipv4.address }}</p>
    <p>Managed by Ansible Automation</p>
  </body>
</html>

nano nginx.conf.j2
server {
    listen 80;
    server_name {{ ansible_hostname }};
    root /var/www/html;
    index index.html;
}
cd ~/assignment4
nano nginx-deploy.yml
---
- name: Deploy Nginx and custom index page
  hosts: webservers
  become: yes

  tasks:
    - name: Install Nginx
      ansible.builtin.apt:
        name: nginx
        state: present
        update_cache: yes

    - name: Deploy Nginx configuration from template
      ansible.builtin.template:
        src: templates/nginx.conf.j2
        dest: /etc/nginx/sites-available/default

    - name: Deploy custom index.html
      ansible.builtin.template:
        src: templates/index.html.j2
        dest: /var/www/html/index.nginx-debian.html

    - name: Restart Nginx to apply changes
      ansible.builtin.service:
        name: nginx
        state: restarted
ansible-playbook nginx-deploy.yml

Set C:
1. Launch two new virtual machine instances. The first should run an operating system from the Debian family, and the second should run one from the Red Hat family.
2. Create a project folder containing an ansible.cfg file and an inventory file. The inventory file should contain the details for two managed nodes. Then, establish and test the connection between the Ansible control node and the two managed nodes.
3. Create an Ansible role named "apache" designed to serve an HTML page displaying the hostname and IPv4 address on an Apache server. This role should be used in playbooks targeting servers within the Debian family.
4. Create an Ansible role named "httpd" designed to serve an HTML page displaying the hostname and IPv4 address on an httpd server. This role should be used in playbooks targeting servers within the RedHat family.
1 â€“ Pre-check Before You Start

From Set B, you should already have:

~/assignment4/
â”œâ”€â”€ ansible.cfg
â”œâ”€â”€ inventory
â”œâ”€â”€ group_vars/
â”œâ”€â”€ host_vars/
â”œâ”€â”€ templates/
â”œâ”€â”€ create-user.yml
â””â”€â”€ nginx-deploy.yml


Verify Ansible connection one more time:

cd ~/assignment4
ansible all -m ping


âœ… pong responses mean youâ€™re ready.

âš™ï¸ 2 â€“ Create a Role Structure

Roles keep your playbooks clean by splitting tasks, templates, and variables into folders.

ansible-galaxy init roles/webrole


It creates:

roles/webrole/
â”œâ”€â”€ defaults/
â”œâ”€â”€ files/
â”œâ”€â”€ handlers/
â”œâ”€â”€ meta/
â”œâ”€â”€ tasks/
â”œâ”€â”€ templates/
â”œâ”€â”€ tests/
â””â”€â”€ vars/


Weâ€™ll use tasks/, templates/, and vars/.

ğŸ§¾ 3 â€“ Add Variables to the Role

Create roles/webrole/vars/main.yml â†’

nano roles/webrole/vars/main.yml

nginx_port: 80
page_title: "Deployed by Ansible Role"
message: "This page is automatically configured via Ansible roles."

ğŸ§© 4 â€“ Add a Template for the Role

Create roles/webrole/templates/index.html.j2

nano roles/webrole/templates/index.html.j2

<html>
  <body style="font-family:Arial; text-align:center; margin-top:60px;">
    <h1>{{ page_title }}</h1>
    <h3>Server: {{ ansible_hostname }}</h3>
    <p>IP: {{ ansible_default_ipv4.address }}</p>
    <p>{{ message }}</p>
  </body>
</html>

ğŸ§± 5 â€“ Define Tasks in the Role

Create roles/webrole/tasks/main.yml

nano roles/webrole/tasks/main.yml

---
- name: Install Nginx
  ansible.builtin.apt:
    name: nginx
    state: present
    update_cache: yes

- name: Deploy custom homepage
  ansible.builtin.template:
    src: index.html.j2
    dest: /var/www/html/index.nginx-debian.html

- name: Ensure Nginx is started
  ansible.builtin.service:
    name: nginx
    state: started
    enabled: yes

ğŸ§© 6 â€“ ( Optional ) Add a Handler

If you want Nginx to restart only when templates change, create:
roles/webrole/handlers/main.yml

---
- name: restart nginx
  ansible.builtin.service:
    name: nginx
    state: restarted


Then, in tasks/main.yml, replace the last two tasks with:

- name: Deploy custom homepage
  ansible.builtin.template:
    src: index.html.j2
    dest: /var/www/html/index.nginx-debian.html
  notify: restart nginx

ğŸ§¾ 7 â€“ Create Main Playbook That Uses the Role

Back in your project root:

nano site.yml

---
- name: Web Server Deployment via Role
  hosts: webservers
  become: yes
  roles:
    - webrole

â–¶ï¸ 8 â€“ Run the Playbook
ansible-playbook site.yml


âœ… Expected output:

TASK [webrole : Install Nginx] ******************
changed: [web1]
changed: [web2]

TASK [webrole : Deploy custom homepage] *********
changed: [web1]
changed: [web2]

TASK [webrole : Ensure Nginx is started] ********
ok: [web1]
ok: [web2]

PLAY RECAP *************************************
web1 : ok=3 changed=2
web2 : ok=3 changed=2

ğŸŒ 9 â€“ Verify on Browser

Open:

http://<web1-public-ip>
http://<web2-public-ip>


You should see:

Deployed by Ansible Role
Server: web1
IP: 172.xx.xx.xx
This page is automatically configured via Ansible roles.
